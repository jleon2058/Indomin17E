<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_service_order_document">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <t t-foreach="docs" t-as="doc">
                    <div class="page">
                        <!-- Encabezado -->
                        <table style="width:100%; border-collapse:collapse; font-family:Arial">
                            <tr>
                                <td rowspan="3" style="border:1px solid black; padding:5px; text-align:center;"><strong>SOLICITUD DE SERVICIO</strong></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Reparación</strong></td>
                                <td style="border:1px solid black; padding:5px; text-align:center;"><t t-esc="'X' if doc.service_steps == 'repair' else ''"/></td>
                            </tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Evaluación</strong></td>
                                <td style="border:1px solid black; padding:5px; text-align:center;"><t t-esc="'X' if doc.service_steps == 'eval' else ''"/></td>
                        </table>

                        <br></br>

                        <table style="width:100%; border-collapse:collapse; font-family:Arial;">
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Descripción OT</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.description or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>OT</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.name or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Área usuaria</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.department or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Revisión</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.assigned_to.name or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Centro de Costo</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_id.code or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Sistema</strong></td>
                                <td style="border:1px solid black; padding:5px;"></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Fecha</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.create_date.strftime('%d/%m/%y')"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Atención</strong></td>
                                <td style="border:1px solid black; padding:5px;">Normal</td>
                            </tr>
                        </table>

                        <h4 style="margin-top:20px;">Datos de Equipo y Componentes</h4>
                        <table style="width:100%; border-collapse:collapse; font-family:Arial;">
                             <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Equipo</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_id.name or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Componente</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.component_id.name or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Modelo</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_model or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Modelo</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.component_model or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Serie</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_serie or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>N° de parte</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.component_serie or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Marca</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_brand or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Marca</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.component_brand or ''"/></td>
                            </tr>
                            <tr>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Horómetro</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.equipment_hourmeter or ''"/></td>
                                <td style="background-color:#f0f0f0; border:1px solid black; padding:5px;"><strong>Horómetro</strong></td>
                                <td style="border:1px solid black; padding:5px;"><t t-esc="doc.component_hourmeter or ''"/></td>
                            </tr>
                        </table>

                        <!-- Tabla de Piezas Requeridas -->
                        <h4 style="margin-top:20px;">Información de piezas requeridas</h4>
                        
                        <table style="width:100%; border: 1px solid black; border-collapse: collapse;">
                            <thead>
                                <tr style="background-color:#f0f0f0;">
                                    <th style="border: 1px solid black; padding:5px;"><strong>Item</strong></th>
                                    <th style="border: 1px solid black; padding:5px;"><strong>Control</strong></th>
                                    <th style="border: 1px solid black; padding:5px;"><strong>Descripción</strong></th>
                                    <th style="border: 1px solid black; padding:5px;"><strong>Actividad</strong></th>
                                    <th style="border: 1px solid black; padding:5px;"><strong>N° de Parte</strong></th>
                                    <th style="border: 1px solid black; padding:5px;"><strong>Cant.</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.parts_required_ids" t-as="part">
                                    <tr style="text-align:center;">
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.item" /></td>
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.control" /></td>
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.description.name" /></td>
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.activity_task" /></td>
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.part_number" /></td>
                                        <td style="border: 1px solid black; padding:5px;"><t t-esc="part.quantity" /></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <br></br>

                        <table style="width:100%; border-collapse:collapse; font-family:Arial;">
                            <thead>
                                <tr>
                                    <th style="background-color:#f0f0f0; border:1px solid black; padding:5px; width:50%;"><strong>Comentarios</strong></th>
                                    <th style="background-color:#f0f0f0; border:1px solid black; padding:5px; width:50%;"><strong>Imagen</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="border:1px solid black; padding:5px; width:50%; vertical-align:top;">
                                        <t t-esc="doc.comments or 'No hay comentarios adicionales.'"/>
                                    </td>
                                    <td style="border:1px solid black; padding:1px; width:50%; text-align:center; vertical-align:middle; max-height:340px;">
                                        <t t-if="doc.image_technical">
                                            <img class="image" 
                                                t-att-src="'data:image/png;base64,%s' % doc.image_technical.decode('utf-8')" 
                                                style="max-width:100%; max-height:100%; width:auto; height:auto; object-fit:contain; display:block; margin:auto;"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <table style="width:100%; border-collapse:collapse; font-family:Arial; margin-top:120px;">
                            <tr>
                                <td style="width:50%; text-align:center;">
                                    <div style="border-top:1px solid black; width:80%; margin:auto; padding-top:5px;"></div>
                                    <strong>Solicitante</strong><br/>
                                    <t t-esc="doc.requested_by.name or ''"/>
                                </td>
                                <td style="width:50%; text-align:center;">
                                    <div style="border-top:1px solid black; width:80%; margin:auto; padding-top:5px;"></div>
                                    <strong>Aprobador</strong><br/>
                                    <t t-esc="doc.assigned_to.name or ''"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>