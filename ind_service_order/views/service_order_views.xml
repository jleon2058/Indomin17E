<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_service_order" model="ir.actions.act_window">
        <field name="name">Órden de trabajo</field>
        <field name="res_model">service.order</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="service_order_view_tree" model="ir.ui.view">
        <field name="name">service.order.view.tree</field>
        <field name="model">service.order</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="delivery_to_supplier_check"/>
                <field name="quote_check"/>
                <field name="rfq_check"/>
                <field name="oc_check"/>
                <field name="delivery_from_supplier_check"/>
                <field name="supplier_report_check"/>
                <field name="conformity_service_check"/>
                <field name="invoice_check"/>
                <field name="documentary_review_check"/>
                <field name="state" widget="badge" />
                <field name="company_id" string="Compañía"/>
            </tree>
        </field>
    </record>

    <record id="service_order_view_form" model="ir.ui.view">
        <field name="name">service.order.view.form</field>
        <field name="model">service.order</field>
        <field name="arch" type="xml">
            <form string="Solicitud de Servicio">
                <!-- Barra de estado -->
                <header>
                    <field name="purchase_request_state" invisible="1"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,approved,done"/>
                    <button name="action_confirm" string="Confirmar" type="object" invisible="state != 'draft'" class="btn-primary"/>
                    <button
                        name="action_approve"
                        string="Aprobar"
                        type="object"
                        invisible="state != 'confirmed'"
                        class="btn-primary"
                        groups="ind_service_order.group_service_order_manager" />
                    <button name="action_done" string="Realizar" type="object" class="btn-primary"
                            invisible="state not in ('approved') or purchase_request_state not in ('done')"
                    />
                    
                    <field name = "show_reset_draft" invisible="1"/>
                    <button name="action_reset_draft"
                          string="Regresar a borrador"
                          type="object"
                          class="btn-primary"
                          invisible="show_reset_draft == False"/>
                    
                    <button name="action_create_rfq" string="Crear Requerimiento" type="object" class="btn-primary" invisible="state != 'approved'" />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                             
                          <button
                            name="action_view_purchase_request"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-file-text-o"
                            invisible="purchase_request_id == False"
                          >
                            <field name="purchase_request_count" string="Requerimiento" widget="statinfo"/>
                        
                          </button>
                         
                        <button name="action_open_conformity"
                            type="object"
                            string="Conformidad"
                            class="oe_stat_button"
                            icon="fa-file-text-o"
                            invisible="((((delivery_to_supplier_check==False or quote_check==False)
                                        or (delivery_from_supplier_check==False))
                                        or (supplier_report_check==False))
                                        or (rfq_check==False))
                                        or (oc_check==False)"
                            />        
                        
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="requested_by" />
                            <field name="assigned_to" />
                            <field name="request_date" />
                            <field name="approval_date" invisible="state in ('draft', 'confirmed')"/>
                            <field name="company_selection_enabled" invisible="1"/>
                            <field name="company_id" readonly="company_selection_enabled == False"/>
                        </group>
                        <group>
                            <field name="department" />
                            <field name="job_title" />
                            <field name="service_steps" />
                            <field name="description" />
                            <field name="purchase_request_id" invisible="1"/>
                        </group>
                    </group>
                    <!-- Bloques de Diagnóstico, Reparación -->
                    <div
                        class="alert alert-warning text-center w-100 border border-warning p-3 d-flex align-items-center justify-content-center"
                        role="alert"
                        style="white-space: nowrap; font-size: min(2vw, 16px); overflow: hidden;">
                        <strong>
                            NOTA: TODA EVALUACIÓN SIN INFORME TÉCNICO QUE NO SE CONCRETE TENDRÁ UN COSTO QUE ASUMIRÁ EL ÁREA SOLICITANTE Y APROBADOR
                        </strong>
                    </div>

                    <group string="Datos de equipo y componentes" name="equipment_component">
                        <group>
                            <field name="equipment_id" placeholder="Seleccione un centro de costo"/>
                            <field name="equipment_model"/>
                            <field name="equipment_serie"/>
                            <field name="equipment_brand"/>
                            <field name="equipment_hourmeter"/>
                        </group>
                        <group>
                            <field name="component_id" placeholder="Seleccione un componente"/>
                            <field name="component_model"/>
                            <field name="component_serie" />
                            <field name="component_brand"/>
                            <field name="component_hourmeter"/>
                        </group>
                    </group>

                    <notebook>
                        <page name="specifications" string="Especificaciones">
                            <group>
                                <group>
                                    <field name="comments" placeholder="Observaciones adicionales..."/>
                                    <field name="attachment_technical_report" widget="file" />
                                </group>
                                <group>
                                    <field name="image_technical" widget="image" />
                                </group>
                            </group>
                        </page>
                        <page string="Piezas Requeridas">
                            <field name="parts_required_ids">
                                <tree editable="bottom">
                                    <field name="item"/>
                                    <field name="control"/>
                                    <field name="description" placeholder="Seleccione un componente"/>
                                    <field name="part_number"/>
                                    <field name="activity_task"/>
                                    <field name="quantity"/>
                                    <field name="area"/>
                                </tree>
                            </field>
                        </page>
                        <!-- 
                        <page string="AEA">
                            <field name="purchase_request_related"/>
                        </page>  -->
                        
                      <page string="Estados de Seguimiento" invisible="state not in ('approved', 'done')">
                         <group invisible="state not in ('approved', 'done')">
                          <separator string="Estados de la OT" colspan="4"/>
        
                           <group col="2">
                             
                             <field name="delivery_to_supplier_check" string="Entrega al Proveedor" readonly="1" widget="boolean_toggle"/>
                             <field name="delivery_to_supplier_date" string=""/>

                             <field name="quote_check" string="Cotización" readonly="1" widget="boolean_toggle"/>
                             <field name="quote_date" string=""/>

                             <field name="rfq_check" string="Requerimiento" readonly="1" widget="boolean_toggle"/>
                             <field name="rfq_date" string=""/>

                             <field name="oc_check" string="Orden de Compra" widget="boolean_toggle"/>
                             <field name="oc_date" string=""/>

                             <field name="delivery_from_supplier_check" string="Entrega del Proveedor" readonly="1" widget="boolean_toggle"/>
                             <field name="delivery_supplier_date" string=""/>

                             <field name="supplier_report_check" string="Informe del Proveedor" readonly="1" widget="boolean_toggle"/>
                             <field name="supplier_report_date" string=""/>

                             <field name="conformity_service_check" string="Conformidad del Servicio" readonly="1" widget="boolean_toggle"/>
                             <field name="conformity_service_date" string=""/>

                             <field name="invoice_check" string="Factura" readonly="1" widget="boolean_toggle"/>
                             <field name="invoice_date" string=""/>

                             <field name="documentary_review_check" string="Revisión Documentaria" readonly="1" widget="boolean_toggle"/>
                             <field name="documentary_review_date" string=""/>
                          </group>
                        </group>
                      </page>
    
                      <page string="Cotizacion">
                          <group>  
                              <field name="quote_report" widget="file" />
                          </group>
                      </page>
                           
                      <page string="Actas e Informes">
                          <group>  
                              <field name="delivery_to_supplier_report" widget="file" />
                          </group>
                          <group>  
                              <field name="supplier_delivery_report" widget="file" />
                          </group>
                          <group>  
                              <field name="supplier_report" widget="file" />
                          </group>
                      </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
</odoo>
