<?xml version="1.0" ?>
<odoo>
    <!-- Formulario para Solicitud de Recojo -->
    <record id="view_pickup_request_form" model="ir.ui.view">
        <field name="name">pickup.request.form</field>
        <field name="model">pickup.request</field>
        <field name="arch" type="xml">
            <form string="Solicitud de Recojo">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,done"/>
                    <button string="Confirmar" type="object" name="action_confirm" invisible="state != 'draft'" class="btn-primary"/>
                    <button string="Recogido" type="object" name="action_done" invisible="state != 'confirmed'" class="btn-success"/>
                    <button string="Restablecer a borrador" type="object" name="action_draft" invisible="state not in ('confirmed', 'cancelled')" class="btn-primary"/>
                    <button string="Cancelar" type="object" name="action_cancel" invisible="state not in ('draft', 'confirmed')" class="btn-danger"/>
                </header>
                <sheet>
                    <header>
                          <button name="print_purchase_order" string="Descargar OC (PDF)" type="object" class="btn-primary"/>                          
                          <button
                            type="object"
                            name="action_view_purchase_order"
                            class="oe_stat_button"
                            string="Orden de Compra"
                            icon="fa-shopping-cart">
                          </button>
                    </header>
                    <group>
                        <group invisible="state != 'draft'">
                            fie
                            <field name="partner_id" widget="many2one_tags" />
                            <field name="purchase_order_id" readonly="1" wdiget="many2one_tags"/>
                            <field name="work_time" string="Horario Laboral"/>
                            <field name="partner_street"/>
                            <field name="delivery_address_id" options="{'create': True, 'no_quick_create': False}" />
                            <field name="request_type" required="1"/>
                            <field name="modality" required="1"/>
                            <field name="urgency" required="1"/>
                            <field name="observations"/>
                        </group>
                        <group invisible="state not in ('confirmed', 'done')">
                            <field name="driver_id" options="{'no_create_edit': False}" placeholder="Escribe un conductor" widget="many2one_tags"/>
                            <field name="warehouse_observations"/>
                            <field name="status"/>
                            <field name="picking_ids" string="Ingresos" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="liquidation_status"/>
                            <field name="invoice_number"/>
                        </group>
                        <group>
                            <field name="accounting_delivery_date" />
                            <field name="datetime_recogido"/>
                        </group>
                        <group>
                            <field name="company_id"/>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>

    <!-- Vista lista para Solicitudes de Recojo -->
    <record id="view_pickup_request_tree" model="ir.ui.view">
        <field name="name">pickup.request.tree</field>
        <field name="model">pickup.request</field>
        <field name="arch" type="xml">
            <tree string="Solicitudes de Recojo" default_order="pickup_datetime desc" decoration-success="picking_ids" decoration-danger="urgency == 'critical' and not picking_ids">
                <field name="pickup_datetime"/>
                <field name="requested_by" widget="many2many_tags" string="Solicitado por"/>
                <field name="purchase_request_ids" widget="many2many_tags" string="RFQ Origen"/>
                <field name="partner_id"/>
                <field name="partner_vat"/>
                <field name="purchase_order_id"/>
                <field name="observations" optional="show"/>
                <field name="work_time" string="Horario Laboral" optional="show"/>
                <field name="partner_street" optional="show"/>
                <field name="delivery_address_id" options="{'create': True, 'no_quick_create': False}" optional="show"/>
                <field name="request_type"/>
                <field name="modality"/>
                <field name="urgency"/>
                <field name="driver_id" optional="show"/>
                <field name="warehouse_observations" optional="show"/>
                <field name="status"/>
                <field name="picking_ids" string="Ingresos" widget="many2many_tags" options="{'no_create': True}"/>
                <field name="guia"/>
                <field name="date_done"/>
                <field name="days_difference" optional="show"/>
                <field name="liquidation_status" optional="show"/>
                <field name="invoice_number" widget="url" string="Factura"/>
                <field name="company_id" string="Compañía"/>
            </tree>
        </field>
    </record>

    <!-- Acción para ver la lista de solicitudes de recojo -->
    <record id="action_pickup_request" model="ir.actions.act_window">
        <field name="name">Solicitudes de Recojo</field>
        <field name="res_model">pickup.request</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Menú para ver las solicitudes de recojo -->
    <menuitem 
        id="menu_pickup_request_root" 
        name="Solicitudes de Recojo" 
        parent="purchase.menu_purchase_root" 
        action="action_pickup_request" 
        groups="ind_purchase_pickup_request.group_pickup_request_user,ind_purchase_pickup_request.group_driver,ind_purchase_pickup_request.group_pickup_request_viewer"/>
    
    <record id="view_pickup_request_search" model="ir.ui.view">
        <field name="name">pickup.request.search</field>
        <field name="model">pickup.request</field>
        <field name="arch" type="xml">
            <search string="Buscar Solicitudes de Recojo">
                <!-- Filtro para modality='pickup' y status='pending_pickup' -->
                <filter 
                    name="pickup_pending" 
                    string="Pickup Pendiente" 
                    domain="[('modality', '=', 'pickup'), ('status', '=', 'pending_pickup')]" 
                    help="Muestra solicitudes con modalidad 'pickup' y estado 'Pendiente de Recojo'." 
                />
                <!-- Filtro para liquidation_status vacío -->
                <filter 
                    name="sin_liquidacion" 
                    string="Sin Liquidación" 
                    domain="[('liquidation_status', '=', False)]" 
                    help="Muestra solicitudes sin estado de liquidación." 
                />
                <!-- Filtro para picking_ids vacío -->
                <filter 
                    name="sin_ingreso" 
                    string="Sin Ingreso" 
                    domain="[('picking_ids', '=', False)]" 
                    help="Muestra solicitudes sin ingreso." 
                />
                <!-- Otros filtros -->
                <field name="requested_by"/>
                <field name="purchase_request_ids"/>
                <field name="purchase_order_id"/>
                <field name="partner_vat"/>
                <field name="state"/>
                <field name="partner_id" />
                <group expand="0" string="Agrupar por...">
                    <filter name="requested_by" string="Solicitado por" context="{'group_by':'requested_by'}"/>
                    <filter name="state" string="Estado" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>
</odoo>
